C51 COMPILER V9.60.7.0   MAIN                                                              06/07/2025 19:16:18 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE code\main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings
                    -\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include "main.h"
   2          
   3          
   4          enum {
   5              CCAP0_TIME = 1000,
   6              UART_LEN = 16,
   7              KEY_TIME = 20
   8          };
   9          
  10          uint setPcaTime;
  11          uchar receiveData[UART_LEN];
  12          
  13          typedef struct {
  14              uchar time;
  15              uchar press;
  16          
  17          } KEY;
  18          
  19          KEY key;
  20          
  21          
  22          long times;
  23          
  24          
  25          
  26          // PCA_______________________________________
  27          
  28          void pcaInterrupt() interrupt 7
  29          {
  30   1          if (CCF0)
  31   1          {
  32   2              CCF0 = 0;
  33   2              setPcaTime += CCAP0_TIME;
  34   2      
  35   2              CCAP0L = setPcaTime;
  36   2              CCAP0H = setPcaTime >> 8;
  37   2              
  38   2              time_1ms();
  39   2          }
  40   1      }
  41          
  42          
  43          // 串口_______________________________________
  44          
  45          // str -> 指针地址
  46          // *str -> 指针的取值
  47          void uartSend(uchar *str)
  48          {       
  49   1          while (*str != '\0')
  50   1          {
  51   2              SBUF = *str;
  52   2              while (TI == 0);
  53   2              TI = 0;
  54   2              str++;
C51 COMPILER V9.60.7.0   MAIN                                                              06/07/2025 19:16:18 PAGE 2   

  55   2          }
  56   1      }
  57          
  58          
  59          void Uart1_Isr(void) interrupt 4
  60          {
  61   1        uchar Data;
  62   1          static uchar index;
  63   1          
  64   1          led_list[0] = 1;
  65   1          seg_list[0] = 1;
  66   1        if (RI)       //检测串口1接收中断
  67   1        {
  68   2          RI = 0;     //清除串口1接收中断请求位
  69   2              Data = SBUF;
  70   2      
  71   2              if (Data != '\n' && index < (UART_LEN - 1))
  72   2              {
  73   3                  receiveData[index] = Data;
  74   3                  index++;
  75   3              }
  76   2              else
  77   2              {
  78   3                  receiveData[index] = '\0';
  79   3                  index = 0;
  80   3                  
  81   3              }
  82   2              //uartSend("ciallo~");
  83   2        }
  84   1          //uartSend("ciallo.cc");
  85   1          
  86   1      }
  87          
  88          
  89          // 任务调度_______________________________________
  90          
  91          
  92          void time_1ms()
  93          {
  94   1          seg_display();
  95   1          led_display();
  96   1      
  97   1          if (key.time < KEY_TIME) { key.time++; }
  98   1          times++;
  99   1      
 100   1       }
 101          
 102          
 103          void task_loop()
 104          {
 105   1          if (key.time == KEY_TIME)
 106   1          {
 107   2              key_task();
 108   2              key.time = 0;
 109   2          }
 110   1      }
 111          
 112          void main()
 113          {
 114   1          uchar message[] = "start";
 115   1          clean_display();
 116   1          timer();
C51 COMPILER V9.60.7.0   MAIN                                                              06/07/2025 19:16:18 PAGE 3   

 117   1          uartSend("start");
 118   1          while (1)
 119   1          {
 120   2              task_loop();
 121   2          }
 122   1      }
 123          
 124          
 125          // _________________________________________任务函数
 126          
 127          void key_task()
 128          {
 129   1          key.press = key_scan();
 130   1          /* if (key.press != 99)
 131   1          {
 132   1              seg_list[0] = key.press / 10;
 133   1              seg_list[1] = key.press / 10 % 10;
 134   1          } */
 135   1         seg_list[3] = times / 10000 % 10;
 136   1         seg_list[4] = times / 1000 % 10;
 137   1         seg_list[5] = times / 100 % 10;
 138   1         seg_list[6] = times / 10 % 10;
 139   1         seg_list[7] = times % 10;
 140   1          
 141   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    412    ----
   CONSTANT SIZE    =     12    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     25       6
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
