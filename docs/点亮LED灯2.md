# 🌟 点亮 LED 灯 —— 单片机入门第一课

学习单片机最经典的第一步，就是 **点亮一颗 LED 灯**。
虽然简单，但这一步包含了 **引脚控制、电路逻辑、锁存器原理、译码器选择** 等一整套控制流程。

为了让你真正理解“为什么这样写代码就能亮灯”，我们从 **电路 → 芯片 → 时序 → 代码** 的顺序展开。

---

## ✅ 零、点灯之前：先看电路整体结构

开发板上的 LED 并不是直接连在单片机的引脚上，而是经过多个逻辑芯片：

```
P0 ——> 74HC573（输出锁存） ——> LED  
P2.5~P2.7 ——> 74HC138（译码器，选择哪个 573）  
P2.x ——> LE（控制锁存时机）
```

一句话总结整个流程：

> **P0 写灯光数据 → 选择 573 → LE 锁存 → LED 点亮**

理解这个数据流后，你接下来的学习不会迷路。

---

## ✅ 一、LED 点亮原理

开发板上的 LED 使用 **0603 封装**，非常小：

<img src="./%E7%82%B9%E4%BA%AElED%E7%81%AF.assets/19A23F6943857869CBE27DE741B1F55B.jpg" alt="A-SP192DGHC-C01-4T实物图" style="zoom:25%;" />

LED 点亮条件：

> **正极接高电压（5V / 3.3V），负极接低电平（GND）即亮。**

在本开发板中：

* LED 正极 → 通过电阻 → 5V
* LED 负极 → 接到 **74HC573 输出端**

所以：

> **想让 LED 亮，只需让 74HC573 对应输出脚 = 0（低电平）**

---

## ✅ 二、控制 LED 的核心：74HC573 锁存器

在原理图中，8 个 LED 的负极全部连接在 **74HC573 的 12~19 引脚（Q0~Q7）** 上：

<img src="./%E7%82%B9%E4%BA%AElED%E7%81%AF.assets/image-20250927133133263.png" alt="原理图" style="zoom:50%;" />

因此我们需要先了解这个芯片。

---

### 1. 芯片外观

<img src="./%E7%82%B9%E4%BA%AElED%E7%81%AF.assets/671C96A40BA1A6914AC0E172685B2FE7.jpg" alt="芯片外观" style="zoom:33%;" />

---

### 2. 它是干什么的？

**74HC573 = 8 位数据锁存器（Octal Transparent Latch）**

作用：

* 暂存 8 bit 数据
* 控制输出是否有效
* 让 LED 电平保持稳定

---

### 3. 引脚功能

| 引脚    | 名称    | 功能            |
| ----- | ----- | ------------- |
| 2~9   | D0~D7 | 输入（接 P0）      |
| 19~12 | Q0~Q7 | 输出（接 LED）     |
| 11    | LE    | 锁存允许（高透明、低锁存） |
| 1     | OE    | 输出使能（接地，始终有效） |

---

### 4. 工作方式（核心）

| LE | 功能             |
| -- | -------------- |
| 1  | 输入 → 直接透传到输出   |
| 0  | 锁存上一次输入，保持输出不变 |

所以点灯流程为：

> **让 LE 高，写 P0 数据，再让 LE 低 → 亮指定 LED**

---

## ✅ 三、74HC02 —— 信号反相（或非门）

<img src="./%E7%82%B9%E4%BA%AElED%E7%81%AF.assets/ED07E25F32818007EFDCA1FBBB2E90A5.jpg" style="zoom:33%;" />

在原理图中，74HC02 的某些输入接地，使它变成一个 **简单反相器**。

逻辑如下：

| 输入 | 输出 |
| -- | -- |
| 0  | 1  |
| 1  | 0  |

它的作用是：

> **把单片机的控制信号反相，得到需要的低电平信号。**

<img src="./%E7%82%B9%E4%BA%AElED%E7%81%AF.assets/QQ_1758952942382.png" alt="QQ\_1758952942382" style="zoom:67%;" />

这用于某些电路控制，但在“点灯流程”中你只需要知道：
**信号经过它后电平会取反。**

---

## ✅ 四、74HC138 —— 选择哪个锁存器工作

<img src="./%E7%82%B9%E4%BA%AElED%E7%81%AF.assets/79A89FC7DE84C54C326B7274BCB233BA.jpg" style="zoom:33%;" />

开发板上有多个 74HC573。
那么单片机要如何告诉硬件：

> “我要操作第 4 号锁存器！”

答案就是 **74HC138 三选八译码器**。

---

### 1. 芯片作用

输入 3 位信号 A2 A1 A0 → 在 8 个输出中选择 1 个变为低电平。

对 573 来说，这个低电平就是“被选中”。

---

### 2. 使能条件（原理图）

![芯片原理图](./%E7%82%B9%E4%BA%AELED%E7%81%AF2.assets/QQ_1762503934511-1762505864759-2.png)

| 引脚  | 状态 |
| --- | -- |
| G2A | 0  |
| G2B | 0  |
| G1  | 1  |

因此芯片始终处于 **使能状态**。

---

### 3. 如何选择第 4 号锁存器？

<img src="./%E7%82%B9%E4%BA%AElED%E7%81%AF.assets/QQ_1758954577525.png" alt="QQ\_1758954577525" style="zoom: 50%;" />

查真值表可知：

> Y4 为低电平时 → 选中第 4 号锁存器
> 所需输入为 **A2 A1 A0 = 100**

在开发板中对应：

| A2   | A1   | A0   |
| ---- | ---- | ---- |
| P2.7 | P2.6 | P2.5 |

所以代码为：

```c
P2 = (P2 & 0x1F) | 0x80;
```

---

## ✅ 五、点亮 LED 的完整流程

现在我们把所有知识串起来：

### ✅ ① 写灯的数据到 P0

低电平 = LED 亮

```c
P0 = 0x00;   // 全亮
```

### ✅ ② 通过 138 选择锁存器

（例如选择 4 号锁存器）

```c
P2 = (P2 & 0x1F) | 0x80;
```

### ✅ ③ 切换 LE，锁存数据

```c
P2 &= 0x1F;   // LE 由高到低，锁存
```

---

## ✅ 六、完整示例代码

```c
#include "stc15f2k60s2.h"

void Delay500ms(void)	//@12.000MHz
{
	unsigned char i, j, k;
	_nop_(); _nop_();
	i = 23; j = 205; k = 120;
	do { do { while (--k); } while (--j); } while (--i);
}

int main()
{
    while(1) 
    {
        P0 = 0xFF;                       // 熄灭LED
        P2 = (P2 & 0x1F) | 0x80;          // LE=1（透明）
        P2 = P2 & 0x1F;                   // LE=0（锁存）
        Delay500ms();					

        P0 = 0x00;                       // 点亮LED
        P2 = (P2 & 0x1F) | 0x80;          
        P2 = P2 & 0x1F;                   
        Delay500ms();					
    }
    
    return 0;
}
```

---

## ✅ 七、封装锁存器函数（可复用）

```c
int latch(uint8_t i)
{
    switch (i) {
        case 4: {P2 = (P2 & 0x1F) | 0x80; break;}
        case 5: {P2 = (P2 & 0x1F) | 0xA0; break;}
        case 6: {P2 = (P2 & 0x1F) | 0xC0; break;}
        case 7: {P2 = (P2 & 0x1F) | 0xE0; break;}
    }
    P2 &= 0x1F;       // 锁存
    return 0;
}
```

使用方法：

```c
P0 = ~0x01;
latch(4);   // 选择第4个锁存器
```

---

## ✅ 八、总结（最重要的记住这些）

| 芯片          | 作用                |
| ----------- | ----------------- |
| **74HC573** | 保存 LED 电平、控制灯     |
| **74HC138** | 选择哪个锁存器工作         |
| **74HC02**  | 信号反相              |
| **P0**      | LED 数据            |
| **P2**      | 控制 138 和 573 的 LE |

✅ **点灯核心逻辑：**

```
P0 写灯的数据
↓
P2 选择 74HC573
↓
LE 锁存
↓
LED 亮
```

