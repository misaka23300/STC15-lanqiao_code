# 🌟 点亮LED灯

学习单片机的第一步，就是 **点亮一颗 LED 灯**。
这看似简单，却是理解单片机控制原理的重要一步。
让我们从原理图和芯片入手，一步步了解点灯的原理与实现。

---

## 一、LED 点亮原理

点亮 LED 灯的条件很简单：

> **正极接高电平（3.3V 或 5V）**，**负极接地（低电平）**，LED 即会发光。

在我们的电路中，LED 的正极经过限流电阻接到 5V 电源，负极接到 **74HC573** 芯片的输出引脚。
因此，只需控制输出端为 **低电平**，即可点亮对应的 LED。

![原理图](./%E7%82%B9%E4%BA%AElED%E7%81%AF.assets/image-20250927133133263.png)

---

## 二、74HC573 锁存器

电路中共有 8 个 LED 灯，它们的负极连接到 **74HC573** 的输出引脚上。
我们只需要让这些引脚输出 **低电平**，LED 灯即可点亮。

---

### 🧩 芯片简介

**74HC573** 是一种 **8 位锁存器（Latch）**，属于 **74HC 系列高速 CMOS 逻辑器件**。
它的主要功能是 **暂存数据** 并 **控制输出**，常用于：

* 数据缓冲
* 总线驱动
* 地址锁存

芯片型号中的 “573” 表示：

> 八路透明锁存器（Octal Transparent Latch）带三态输出。

---

### ⚙️ 主要功能

| 功能                       | 描述                                                  |
| ------------------------ | --------------------------------------------------- |
| **锁存数据（Latch）**          | 当 LE 为高电平时，输入端数据直接透传到输出端；当 LE 变为低电平时，输出端保持最后一次输入状态。 |
| **三态输出（3-State Output）** | 通过 OE 控制输出是否连接到总线。OE = 1 时输出高阻态，OE = 0 时输出有效。       |

---

### 🧠 引脚定义（DIP-20 封装）

| 引脚号   | 名称        | 类型 | 功能说明        |
| ----- | --------- | -- | ----------- |
| 1     | **OE**    | 输入 | 输出使能（低电平有效） |
| 11    | **LE**    | 输入 | 锁存使能（高电平透明） |
| 2–9   | **D0–D7** | 输入 | 数据输入端       |
| 19–12 | **Q0–Q7** | 输出 | 数据输出端       |
| 10    | **GND**   | 电源 | 地线          |
| 20    | **VCC**   | 电源 | +5V 电源      |

---

### 🔄 工作逻辑

| LE | OE | 功能说明                 |
| -- | -- | -------------------- |
| H  | L  | **透明状态**：输出 Q 跟随输入 D |
| L  | L  | **锁存状态**：输出保持最后一次输入值 |
| X  | H  | **高阻态**：输出断开         |

---

### 💡 控制说明

* **LE（锁存使能）**

  * 高电平 → 输入透传到输出
  * 低电平 → 输出锁存最后的输入值

* **OE（输出使能）**

  * 低电平 → 输出有效
  * 高电平 → 输出关闭（高阻态）

也就是说：

> 我们可以先配置输入端的电平，再通过 **LE 高 → 低** 的切换锁存数据。
> 此时，即使输入端发生变化，输出端仍保持原有状态。

---

### 📸 芯片外观

![芯片外观](./%E7%82%B9%E4%BA%AElED%E7%81%AF.assets/671C96A40BA1A6914AC0E172685B2FE7.jpg)

---

### ⚙️ 控制逻辑在电路中的作用

在原理图中：

* **OE 引脚接地** → 芯片输出有效；
* **LE 引脚** 由单片机控制；
* **输入端 D0–D7** 连接在单片机的 **P0 口**。

![QQ\_1758952763497](./%E7%82%B9%E4%BA%AElED%E7%81%AF.assets/QQ_1758952763497.png)

因此，只需设置 P0 输出低电平，并切换 LE 引脚，即可点亮对应的 LED。

---

## 三、74HC02 —— 四路或非门（NOR）

![QQ\_1758952942382](./%E7%82%B9%E4%BA%AElED%E7%81%AF.assets/QQ_1758952942382.png)

`74HC02` 是一款 **四路二输入或非门（NOR）芯片**。
其逻辑关系如下：

| A | B | 输出 Y = ¬(A + B) |
| - | - | --------------- |
| 0 | 0 | 1               |
| 0 | 1 | 0               |
| 1 | 0 | 0               |
| 1 | 1 | 0               |

在原理图中，每个 NOR 门的一端接地，因此它起到 **反相器（NOT 门）** 的作用：

> 输入 1 → 输出 0
> 输入 0 → 输出 1

为了让 **Y4C** 由高电平切换成低电平，只需将 **Y4** 由低变高即可。

---

## 四、74HC138 —— 三选八译码器

> 74HC138 是一种 **3-线至 8-线 译码器**，常用于存储器地址解码或数据选择。
> 它具有 3 个输入端（A、B、C）和 3 个使能端（G1、G2A、G2B）。

芯片真值表如下：

![QQ\_1758954577525](./%E7%82%B9%E4%BA%AElED%E7%81%AF.assets/QQ_1758954577525.png)

![QQ\_1758954720021](./%E7%82%B9%E4%BA%AElED%E7%81%AF.assets/QQ_1758954720021.png)

---

### ⚙️ 电路连接分析

根据原理图：

| 芯片引脚     | 连接  | 电平状态 |
| -------- | --- | ---- |
| G2A → E1 | GND | 低电平  |
| G2B → E2 | GND | 低电平  |
| G1 → E3  | VCC | 高电平  |

此时，译码器被**使能**。
只需改变 A0、A1、A2 的输入状态（连接 P2.5~P2.7），即可选择哪一路输出为低电平。

![QQ\_1758955723512](./%E7%82%B9%E4%BA%AElED%E7%81%AF.assets/QQ_1758955723512.png)

要使 **Y4** 输出低电平，需设置：

> A2A1A0 = 100
> 即 P2.7=1, P2.6=0, P2.5=0

---

### 🧮 代码实现

```c
P2 = (P2 & 0x1F) | 0x80;
// 0x1F -> 0001 1111  保留低5位
// 0x80 -> 1000 0000  设置A2A1A0=100
```

---

## 五、综合点灯流程

1. **设置 P0** 为低电平（决定点亮哪个 LED）
2. **控制 P2.5–P2.7** 选择 74HC573 锁存器
3. **切换 LE 高→低** 锁存数据
4. **LED 点亮**

示例代码如下：

```c
#include "stc15f2k60s2.h"

int main()
{
    P0 = ~0x01;                       // 点亮第1个LED（低电平有效）
    P2 = (P2 & 0x1F) | 0x80;          // 选择锁存器
    P2 = P2 & 0x1F;                   // 锁存数据
    while(1);
}
```

---

## 六、封装锁存器函数

为了便于调用，我们将锁存器操作封装为函数：

```c
void batch(uint8_t i)
{
    switch (i) {
        case 4: {P2 = (P2 & 0x1F) | 0x80; break;}
        case 5: {P2 = (P2 & 0x1F) | 0xA0; break;}
        case 6: {P2 = (P2 & 0x1F) | 0xC0; break;}
        case 7: {P2 = (P2 & 0x1F) | 0xE0; break;}
    }
    P2 = P2 & 0x1F;   // 关闭锁存器，锁存数据
}
```

使用方法：

```c
P0 = ~0x01;
batch(4);   // 操作第4号锁存器
```

这样即可轻松控制不同的锁存器，而无需重复写寄存器操作。

---

## 七、总结

通过本节学习，我们掌握了：

| 芯片             | 功能            |
| -------------- | ------------- |
| **74HC573**    | 数据锁存与输出控制     |
| **74HC02**     | 信号取反（反相）      |
| **74HC138**    | 选择不同锁存器（地址译码） |
| **P0 / P2 端口** | 单片机输出控制端      |

**完整点灯逻辑：**

> P0 输出数据 → 选择锁存器（P2 控制） → LE 锁存 → LED 点亮

---
